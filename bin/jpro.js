/**
 * @license
 * JugglePro - v0.0.2
 * Copyright (c) 2014, Ed Carstens
 * http://www.wealthygames.com/
 *
 * Compiled: 2015-03-15
 *
 * JugglePro is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
var JPRO=JPRO||{};JPRO.VERSION="v0.0.2",JPRO.XAXIS=0,JPRO.YAXIS=1,JPRO.ZAXIS=2,JPRO.SHOULDERWIDTH=80,JPRO.UPPERARMLENGTH=100,JPRO.FOREARMLENGTH=120,JPRO.HANDLENGTH=25,JPRO.ID={},function(){"use strict";JPRO.Base=function(a){this.className=this.className||"Base",this.name=a||this.className+"_"+JPRO.ID[this.className]++},JPRO.Base.prototype.constructor=JPRO.Base,JPRO.Base.prototype.copyOnce=function(a,b,c,d,e){if(a=a||{},void 0!==a[this.name])return a[this.name];b=b||function(){return new JPRO[this.className]};var f,g,h;c=c||{},c.name=1,c.className=1,c.constructor=1,d=d||{},e=e||[],h=JPRO.ID[this.className],f=b.call(this),JPRO.ID[this.className]=h,f.name=this.name+"_copy",a[this.name]=f,a[f.name]=this;for(g in this)c[g]||(d[g]?f[g]=d[g](this[g],a):(h=typeof this[g],"function"!==h&&(f[g]=this[g]&&"object"===h?this[g].copy(a):this[g])));for(h in e)g=e[h],f[g]=this[g];return f},JPRO.Base.prototype.directedCopy=function(a,b,c,d,e){if(a=a||{},void 0!==a[this.name])return a[this.name];b=b||function(){return new JPRO[this.className]};var f,g,h;c=c||{},d=d||[],e=e||[],h=JPRO.ID[this.className],f=b.call(this),JPRO.ID[this.className]=h,f.name=this.name+"_copy",a[this.name]=f,a[f.name]=this;for(g in c)f[g]=c[g](this[g],a);for(h in d)g=d[h],f[g]=this[g];for(h in e)g=e[h],f[g]=this[g].copy(a);return f},JPRO.Base.prototype.copy=function(a,b){return this.copyOnce(a,b)}}(),function(){"use strict";JPRO.Common={},JPRO.Common.copyHash=function(a){var b,c={};for(b in a)c[b]=a[b];return c},JPRO.Common.copyMatrix=function(a,b){if(0===b)return a;var c,d=[];for(c=0;c<a.length;c++)d.push(JPRO.Common.copyMatrix(a[c],b-1));return d},JPRO.Common.makeCopyMatrix=function(a){return function(b){return JPRO.Common.copyMatrix(b,a)}},JPRO.Common.copyObjMatrix=function(a,b){var c,d=[];for(c=0;c<a.length;c++)d.push(JPRO.Common.copyObjVector(a[c],b));return d},JPRO.Common.copyObjVector=function(a,b){var c,d=[];for(c=0;c<a.length;c++)d.push(a[c].copy(b));return d}}(),JPRO.Gui=function(a){this.viewer=a},JPRO.Gui.prototype.constructor=JPRO.Gui,JPRO.Gui.prototype.init=function(){var a,b;if(a=this.viewer,a&&(b=a.pattern)){$("#div1").html(b.toHtml());var c=this.makeSlider("Base Period","BasePeriod",{val:viewer.clock.basePeriod,min:5,max:75,step:1,start:10,end:70,tstep:10}),d=this.makeSlider("Dwell Ratio","DwellRatio",{val:100*viewer.dwellRatio,min:0,max:100,step:1,start:0,end:100,tstep:10});$("#div2").html(c),$("#div3").html(d),this.updateDwellRatio(100*viewer.dwellRatio),this.updateBasePeriod(viewer.clock.basePeriod),this.initButtons()}},JPRO.Gui.prototype.makeSlider=function(a,b,c){var d,e=b+"_fader",f=b+"_settings",g='"viewer.gui.update'+b+'(value)"',h="<label for="+e+">"+a+"</label>";for(h+="<input type=range min="+c.min+" max="+c.max+" value="+c.val,h+=" id="+e+" step="+c.step+" list="+f+" oninput="+g+">",h+="<output for="+e+" id="+b+">"+c.val+"</output>",h+="<datalist id="+f+">",d=c.start;d<=c.end;d+=c.tstep)h+="<option>"+d+"</option>";return h+="</datalist>"},JPRO.Gui.prototype.initButtons=function(){$("#start_button").hide(),$("#pause_button").click(function(){viewer.enable=null,$("#pause_button").hide(),$("#start_button").show()}),$("#start_button").click(function(){viewer.enable=1,requestAnimFrame(animate),$("#start_button").hide(),$("#pause_button").show()}),$("#pause_rot").hide(),$("#pause_rot").click(function(){viewer.rotEnable=null,$("#pause_rot").hide(),$("#start_rot").show()}),$("#start_rot").click(function(){viewer.rotEnable=1,$("#start_rot").hide(),$("#pause_rot").show()})},JPRO.Gui.prototype.updateBasePeriod=function(a){console.log("update base period = "+a),viewer.clock.basePeriod=a,$("#BasePeriod").html(a)},JPRO.Gui.prototype.updateDwellRatio=function(a){var b,c;console.log("update dwell ratio = "+a),viewer.dwellRatio=a/100;for(b in viewer.jugglers)for(c in viewer.jugglers[b].hands)viewer.jugglers[b].hands[c].dwellRatio=viewer.dwellRatio;$("#DwellRatio").html(a+"%")},JPRO.Gui.prototype.updateTestVar=function(a){viewer.testVar=a,viewer.view.translateMe(viewer.zoomIn),viewer.zoomOut.y=100*a,viewer.zoomIn.y=-100*a,viewer.view.translateMe(viewer.zoomOut),$("#testVar").html(viewer.zoomOut.y)},JPRO.ID.Juggler=0,JPRO.Juggler=function(a,b,c,d,e,f){if(this.className=this.className||"Juggler",JPRO.Base.call(this,b),this.viewer=a,this.neckPos=void 0===d||null===d?new JPRO.Vec(0,200,100):d,this.facingAngle=void 0===e||null===e?-90:e,void 0===f&&(f={}),this.shoulderWidth=f.shoulderWidth||JPRO.SHOULDERWIDTH,this.upperArmLength=f.upperArmLength||JPRO.UPPERARMLENGTH,this.foreArmLength=f.foreArmLength||JPRO.FOREARMLENGTH,this.handLength=f.handLength||JPRO.HANDLENGTH,void 0!==c&&null!==c)this.hands=c;else{var g=JPRO.Handfun.cascL(this),h=JPRO.Handfun.cascR(this),i=new JPRO.Hand(this.viewer,this.name+"_LH",g,0),j=new JPRO.Hand(this.viewer,this.name+"_RH",h,1);this.hands=[i,j]}},JPRO.Juggler.prototype=Object.create(JPRO.Base.prototype),JPRO.Juggler.prototype.constructor=JPRO.Juggler,JPRO.Juggler.prototype.copy=function(a,b){var c={};return c.hands=JPRO.Common.copyObjVector,b=b||function(){return new JPRO.Juggler(null,1,[],1,1,{})},this.copyOnce(a,b,{},c)},JPRO.Juggler.prototype.update=function(a){var b;for(b in this.hands)this.hands[b].update(a)},JPRO.Juggler.prototype.updatePos=function(){var a;for(a in this.hands)this.hands[a].updatePos()},JPRO.Juggler.prototype.nextBeat=function(){var a;for(a in this.hands)this.hands[a].nextBeat()},function(){"use strict";JPRO.ID.Hand=0,JPRO.Hand=function(a,b,c,d,e){this.className=this.className||"Hand",JPRO.Base.call(this,b),this.viewer=a,this.view=a.view,this.dwellRatio=e||this.viewer.dwellRatio,this.isRight=d,this.beat=0,this.movementBeat=0,this.props=[],this.hFunc=c,this.movementPeriod=c.movementPeriod,this.pos=new JPRO.Vec,this.posProjected=new JPRO.Vec},JPRO.Hand.prototype=Object.create(JPRO.Base.prototype),JPRO.Hand.prototype.constructor=JPRO.Hand,JPRO.Hand.prototype.copy=function(a,b){b=b||function(){return new JPRO.Hand({},1,{},1,1)};var c={};return c.props=1,this.copyOnce(a,b,c)},JPRO.Hand.prototype.updatePos=function(){var a=this.hFunc.getPos(0,this.movementBeat);this.pos=this.view.transform(a[0])},JPRO.Hand.prototype.update=function(a){var b,c=this.viewer.clock.duration(this.name),d=a[this.name];b=.01>d?.5:c/d;var e=this.hFunc.getPos(b,this.movementBeat),f=this.view.project(this.view.transform(e[1])),g=this.view.project(this.view.transform(e[2])),h=this.view.project(this.view.transform(e[3])),i=this.view.project(this.view.transform(e[4]));this.pos=this.view.transform(e[0]),this.posProjected=this.view.project(this.pos);var j=this.posProjected.x,k=this.posProjected.y,l=this.viewer.grfx;l.lineStyle(1,16764006,1),l.beginFill(16764006),l.drawCircle(g.x,g.y,8),l.drawCircle(h.x,h.y,8),l.endFill(),l.lineStyle(16,16764006,1),l.moveTo(j,k),l.lineTo(g.x,g.y),l.moveTo(g.x,g.y),l.lineTo(h.x,h.y),l.moveTo(h.x,h.y),l.lineTo(i.x,i.y),l.lineStyle(4,16764006,1);var m=j-g.x,n=k-g.y,o=f.x-j,p=f.y-k;this.isRight||(o=-o,p=-p),l.moveTo(j+o,k+p),l.lineTo(g.x,g.y);var q=o>>2,r=p>>2,s=j+q,t=k+r,u=j-q,v=k-r,w=j-(o>>1),x=k-(p>>1),y=s+m,z=t+n,A=j+m,B=k+n,C=u+m,D=v+n,E=w+m,F=x+n;l.moveTo(s,t),l.lineTo(y,z),l.moveTo(j,k),l.lineTo(A,B),l.moveTo(u,v),l.lineTo(C,D),l.moveTo(w,x),l.lineTo(E,F),l.moveTo(w,x),l.lineTo(s,t),l.moveTo(s,t),l.lineTo(s-m,t-n),l.moveTo(s-m,t-n),l.lineTo(w-m,x-n),l.moveTo(w-m,x-n),l.lineTo(w,x)},JPRO.Hand.prototype.getDwellRatio=function(){return this.dwellRatio},JPRO.Hand.prototype.nextBeat=function(){var a;this.movementBeat>=this.movementPeriod-1?this.movementBeat=0:this.movementBeat++,a=this.hFunc.getPos(0,this.movementBeat),this.pos=this.view.transform(a[0])},JPRO.Hand.prototype.catchProp=function(a,b){var c=b||0;console.log(this.name+" caught ball"),this.props.push(a),0===c&&a.caughtBy(this,1)},JPRO.Hand.prototype.throwProp=function(a){var b;this.props.length>0?b=this.props.shift():(b=this.viewer.grabNewProp(),b.pos.setV(this.pos)),b.throw2Hand(a)},JPRO.Hand.prototype.nprops=function(){return this.props.length},JPRO.Hand.prototype.dropProp=function(a){var b,c;for(c=0;a>c;c++)b=this.props.shift(),this.viewer.dropProp(b)}}(),function(){"use strict";JPRO.Handfun=function(){},JPRO.Handfun.scale=5,JPRO.Handfun.Bone=function(a){this.length=a},JPRO.Handfun.Bone.prototype={pitch:0,yaw:0,roll:0},JPRO.Handfun.Bone.prototype.constructor=JPRO.Handfun.Bone,JPRO.Handfun.Pose=function(a,b,c,d,e){this.pos=a,this.facingAngle=b,this.bones=[new JPRO.Handfun.Bone(c),new JPRO.Handfun.Bone(d),new JPRO.Handfun.Bone(e)],this.set=function(a,b,c,d,e,f){this.bones[0].pitch=a,this.bones[0].yaw=b,this.bones[1].pitch=c,this.bones[1].yaw=d,this.bones[1].roll=e,this.bones[2].pitch=f},this.jointPos=function(){var a=new JPRO.Rmatrix(this.bones[0].pitch,0),b=new JPRO.Rmatrix(this.bones[0].yaw,2);a.xMatrix(b),a.col4=new JPRO.Vec(0,0,0);var c=new JPRO.Rmatrix(this.bones[1].pitch,0),d=new JPRO.Rmatrix(this.bones[1].yaw,2),e=new JPRO.Rmatrix(this.bones[1].roll,1);c.xMatrix(d).xMatrix(e),c.col4=new JPRO.Vec(0,this.bones[0].length,0);var f=a.xVec(c.col4),g=new JPRO.Rmatrix(this.bones[2].pitch,0);g.col4=new JPRO.Vec(0,this.bones[1].length,0),a.xMatrix4(c.xMatrix4(g));var h=a.xVec4(new JPRO.Vec(0,this.bones[2].length,0)),i=a.xVec4(new JPRO.Vec(this.bones[2].length,0,0)),j=new JPRO.Rmatrix(this.facingAngle-90,2);j.col4=(new JPRO.Vec).setV(this.pos);var k=j.xVec4(f),l=j.xVec4(a.col4),m=j.xVec4(h),n=j.xVec4(i),o=[m,n,l,k];return o}},JPRO.Handfun.Pose.prototype.constructor=JPRO.Handfun.Pose,JPRO.ID.Func=0,JPRO.Handfun.Func=function(a,b,c,d){var e,f,g;if(this.className=this.className||"Func",JPRO.Base.call(this,d),this.owner=a,a){this.scale=JPRO.Handfun.scale;var h=a.neckPos;this.shoulderWidth=a.shoulderWidth,this.upperArmLength=a.upperArmLength,this.foreArmLength=a.foreArmLength,this.handLength=a.handLength,this.shoulderAngle=b?-90:90,this.facingAngle=a.facingAngle;var i=(this.facingAngle+this.shoulderAngle)*PIXI.DEG_TO_RAD,j=h.getX()+this.shoulderWidth*Math.cos(i),k=h.getY()+this.shoulderWidth*Math.sin(i);this.shoulderPos=new JPRO.Vec(j,k,h.getZ()),this.ps=new JPRO.Vec,this.ps.setV(this.shoulderPos),this.ps.scale(this.scale)}if(void 0!==c&&null!==c){this.movementPeriod=c.length,this.nposes2=[],this.nposes=[];var l;this.posesXva=[];var m=[],n=[];for(e=0;e<this.movementPeriod;e++)this.nposes2.push(c[e].length),this.nposes.push(c[e].length<<1),m=m.concat(c[e]);for(l=JPRO.Matrix.transpose(m),n=this.calcXva(l),g=0,f=0;f<this.movementPeriod;f++){for(this.posesXva.push([]),e=0;e<n.length;e++)this.posesXva[f].push(n[e].slice(g,g+this.nposes[f]));g+=this.nposes[f]}g=99}},JPRO.Handfun.Func.prototype=Object.create(JPRO.Base.prototype),JPRO.Handfun.Func.prototype.constructor=JPRO.Handfun.Func,JPRO.Handfun.Func.prototype.copy=function(a,b){var c={};c.posesXva=JPRO.Common.makeCopyMatrix(4),b=b||function(){return new JPRO.Handfun.Func};var d={};d.nposes2=1,d.nposes=1;var e=this.copyOnce(a,b,d,c);return e.nposes2=this.nposes2.slice(),e.nposes=this.nposes.slice(),e},JPRO.Handfun.Func.prototype.getPose=function(a,b){var c=b%this.movementPeriod,d=this.nposes[c],e=a*d;e>=d&&(e-=d);var f,g,h,i,j,k,l=Math.floor(e),m=e-l,n=[];for(f=0;f<this.posesXva[c].length;f++)g=this.posesXva[c][f][l],h=g[0],i=g[1],j=g[2],k=h+i*m/2+j*m*m/4,n.push(k);var o=new JPRO.Handfun.Pose(this.shoulderPos,this.facingAngle,this.upperArmLength,this.foreArmLength,this.handLength);return o.set(n[0],n[1],n[2],n[3],n[4],n[5]),o},JPRO.Handfun.Func.prototype.getPos=function(a,b){var c=this.getPose(a,b),d=c.jointPos(),e=(new JPRO.Vec).setV(d[0]),f=(new JPRO.Vec).setV(d[1]),g=(new JPRO.Vec).setV(d[2]),h=(new JPRO.Vec).setV(d[3]);return e.scale(this.scale),f.scale(this.scale),g.scale(this.scale),h.scale(this.scale),[e,f,g,h,this.ps]},JPRO.Handfun.Func.prototype.calcXva=function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(this.interpolator(a[b]));return c},JPRO.Handfun.Func.prototype.interpolator=function(a){var b,c,d,e,f=function(a,b){for(var c=b-a;-180>=c;)c+=360;for(;c>180;)c-=360;return c},g=[],h=[],i=[],j=[],k=[],l=a.length;for(b=0;l>b;b++)c=(b+1)%l,g[b]=f(a[b],a[c]);for(b=0;l>b;b++)c=(b-1+l)%l,d=b<<1,h[d]=g[c]>=0&&g[b]<=0?0:g[c]<=0&&g[b]>=0?0:(g[c]+g[b])/2;for(b=0;l>b;b++)d=b<<1,c=d+1,e=b===l-1?0:c+1,h[c]=2*g[b]-(h[d]+h[e])/2;for(b=0;b<h.length;b++)c=b===h.length-1?0:b+1,i[b]=h[c]-h[b];for(c=0,b=0;l>b;b++)j.push(a[b]),j.push(a[b]+h[c]/2+i[c]/4),c+=2;return k.push(j),k.push(h),k.push(i),k=JPRO.Matrix.transpose(k)},JPRO.Handfun.mirrorX=function(a){var b,c,d,e=[];for(b=0;b<a.length;b++){for(d=[],c=0;c<a[b].length;c++)d.push([a[b][c][0],-a[b][c][1],a[b][c][2],-a[b][c][3],-a[b][c][4],a[b][c][5]]);e.push(d)}return e},JPRO.Handfun.casc=[[[-70,10,90,10,0,0],[-70,15,95,15,0,0],[-70,0,70,0,0,0],[-70,-5,58,-5,0,0],[-70,-10,45,-10,0,0],[-70,-5,58,-5,0,0],[-70,0,70,0,0,0],[-70,5,82,5,0,0]]],JPRO.Handfun.cascR=function(a){return new JPRO.Handfun.Func(a,1,JPRO.Handfun.casc,"cascR")},JPRO.Handfun.cascL=function(a){return new JPRO.Handfun.Func(a,0,JPRO.Handfun.mirrorX(JPRO.Handfun.casc),"cascL")},JPRO.Handfun.revCasc=[[[-70,-20,80,-40,0,30],[-70,-20,100,-40,0,30],[-70,0,80,-20,0,30],[-70,10,60,5,0,30],[-70,20,60,10,0,30],[-70,10,60,5,0,30],[-70,0,60,0,0,30],[-70,-10,60,-20,0,30]]],JPRO.Handfun.revCascR=function(a){return new JPRO.Handfun.Func(a,1,JPRO.Handfun.revCasc,"revCascR")},JPRO.Handfun.revCascL=function(a){return new JPRO.Handfun.Func(a,0,JPRO.Handfun.mirrorX(JPRO.Handfun.revCasc),"revCascL")},JPRO.Handfun.rshowerRm=[[[-70,0,40,-60,0,0],[-70,0,60,-60,0,0],[-70,0,35,-60,0,0],[-70,0,10,-60,40,0],[-70,0,-20,-60,80,0],[-70,0,-10,-60,40,0],[-70,0,0,-60,0,0],[-70,0,0,-60,0,0]]],JPRO.Handfun.rshowerR=function(a){return new JPRO.Handfun.Func(a,1,JPRO.Handfun.rshowerRm,"rshowerR")},JPRO.Handfun.rshowerLm=[[[-70,0,70,-25,0,0],[-70,0,70,-60,0,0],[-70,0,70,-20,0,0],[-70,0,70,20,0,0],[-70,0,70,20,0,0],[-70,0,70,20,0,0],[-70,0,70,20,0,0],[-70,0,70,10,0,0]]],JPRO.Handfun.rshowerL=function(a){return new JPRO.Handfun.Func(a,0,JPRO.Handfun.rshowerLm,"rshowerL")},JPRO.Handfun.lshowerR=function(a){return new JPRO.Handfun.Func(a,1,JPRO.Handfun.mirrorX(JPRO.Handfun.rshowerRm),"lshowerR")},JPRO.Handfun.lshowerL=function(a){return new JPRO.Handfun.Func(a,0,JPRO.Handfun.mirrorX(JPRO.Handfun.rshowerLm),"lshowerL")},JPRO.Handfun.box=[[[-70,-10,80,-20,0,20],[-70,-5,70,-15,0,10],[-70,0,60,-10,0,0],[-70,0,60,-5,0,0],[-70,0,60,0,0,0],[-70,0,60,5,0,0],[-70,0,60,10,0,0],[-70,5,70,15,0,10]],[[-70,10,80,20,0,20],[-70,5,70,15,0,10],[-70,0,60,10,0,0],[-70,0,60,5,0,0],[-70,0,60,0,0,0],[-70,0,60,-5,0,0],[-70,0,60,-10,0,0],[-70,-5,70,-15,0,10]]],JPRO.Handfun.boxR=function(a){return new JPRO.Handfun.Func(a,1,JPRO.Handfun.box,"boxR")},JPRO.Handfun.boxL=function(a){return new JPRO.Handfun.Func(a,0,JPRO.Handfun.box,"boxL")},JPRO.Handfun.stationaryL=function(a){return new JPRO.Handfun.Func(a,0,[[[-90,0,90,0,50,0]]],"stationaryL")},JPRO.Handfun.stationaryR=function(a){return new JPRO.Handfun.Func(a,1,[[[-90,0,90,0,20,0]]],"stationaryR")},JPRO.Handfun.experimentL=function(a){return new JPRO.Handfun.Func(a,0,[[[-90,0,90,0,0,0],[-90,0,90,0,90,0],[-90,0,90,0,180,0],[-90,0,90,0,270,0]]],"xL")},JPRO.Handfun.experimentR=function(a){return new JPRO.Handfun.Func(a,1,[[[-90,0,90,0,180,0],[-90,0,90,0,270,0],[-90,0,90,0,0,0],[-90,0,90,0,90,0]]],"xR")}}(),JPRO.ID.RowHandMapper=0,JPRO.RowHandMapper=function(a,b){if(this.className=this.className||"RowHandMapper",JPRO.Base.call(this,a),this.rhm=b,this.rhm){this.rowBeats=this.makeArray(this.rhm.length);var c,d;for(this.handToRowHash={},c=0;c<this.rhm.length;c++)for(d=0;d<this.rhm[c].length;d++)this.handToRowHash[this.rhm[c][d].name]=c}},JPRO.RowHandMapper.prototype=Object.create(JPRO.Base.prototype),JPRO.RowHandMapper.prototype.constructor=JPRO.RowHandMapper,JPRO.RowHandMapper.prototype.copy=function(a,b){var c={};c.rhm=JPRO.Common.copyObjMatrix,c.handToRowHash=JPRO.Common.copyHash,b=b||function(){return new JPRO.RowHandMapper};var d={};d.rowBeats=1;var e=this.copyOnce(a,b,d,c);return e.rowBeats=this.rowBeats.slice(),e},JPRO.RowHandMapper.prototype.toString=function(){var a,b,c="{rhm:[";for(a=0;a<this.rhm.length;a++){for(a>0&&(c+=", "),c+="[",b=0;b<this.rhm[a].length;b++)b>0&&(c+=", "),c+=this.rhm[a][b].name;c+="]"}for(c+="], rowBeats:[",a=0;a<this.rowBeats.length;a++)a>0&&(c+=", "),c+=this.rowBeats[a];return c+="]}"},JPRO.RowHandMapper.prototype.getHand=function(a,b){var c=b||0,d=this.rhm[a];void 0===d&&(console.log(this.name),console.log("rhm[0][0]="+this.rhm[0][0].name),console.log("rhm[1]="+this.rhm[1]),console.log("rhm[1][0]="+this.rhm[1][0].name),alert("hello"));var e=(this.rowBeats[a]+c)%d.length;return d[e]},JPRO.RowHandMapper.prototype.getHandBeatsToNextThrow=function(a){for(var b=this.handToRow(a),c=this.rowBeats[b],d=this.rhm[b],e=1;999>e;){if(a===d[(c+e)%d.length])return e;e++}return 0},JPRO.RowHandMapper.prototype.nextBeat=function(){var a;for(a=0;a<this.rowBeats.length;a++)this.rowBeats[a]>=this.rhm[a].length-1?this.rowBeats[a]=0:this.rowBeats[a]++;return this},JPRO.RowHandMapper.prototype.makeArray=function(a,b){var c,d=b||0,e=[];for(c=a-1;c>=0;c--)e[c]=d;return e},JPRO.RowHandMapper.prototype.handToRow=function(a){return this.handToRowHash[a.name]},function(){"use strict";JPRO.ID.Vec=0,JPRO.Vec=function(a,b,c){this.className=this.className||"Vec",JPRO.Base.call(this),this.x=a||0,this.y=b||0,this.z=c||0},JPRO.Vec.prototype=Object.create(JPRO.Base.prototype),JPRO.Vec.prototype.constructor=JPRO.Vec,JPRO.Vec.prototype.getX=function(){return this.x},JPRO.Vec.prototype.getY=function(){return this.y},JPRO.Vec.prototype.getZ=function(){return this.z},JPRO.Vec.prototype.set=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},JPRO.Vec.prototype.setV=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},JPRO.Vec.prototype.mDist=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},JPRO.Vec.prototype.mDist2=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},JPRO.Vec.prototype.scale=function(a){this.x=this.x<<a,this.y=this.y<<a,this.z=this.z<<a},JPRO.Vec.prototype.add=function(a){return new JPRO.Vec(this.x+a.x,this.y+a.y,this.z+a.z)},JPRO.Vec.prototype.acc=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},JPRO.Vec.prototype.toString=function(){return"("+this.x+","+this.y+","+this.z+")"}}(),function(){"use strict";JPRO.ID.Matrix=0,JPRO.Matrix=function(a,b,c,d){this.className=this.className||"Matrix",JPRO.Base.call(this);var e=a||new JPRO.Vec(1,0,0),f=b||new JPRO.Vec(0,1,0),g=c||new JPRO.Vec(0,0,1);this.m=[e.getX(),e.getY(),e.getZ(),f.getX(),f.getY(),f.getZ(),g.getX(),g.getY(),g.getZ()],this.col4=void 0===d?new JPRO.Vec:d},JPRO.Matrix.prototype=Object.create(JPRO.Base.prototype),JPRO.Matrix.prototype.constructor=JPRO.Matrix,JPRO.Matrix.prototype.copy=function(a,b){var c=this.copyOnce(a,b,{m:1});return c.m=this.m.slice(),c},JPRO.Matrix.prototype.xMatrix=function(a){var b,c,d,e,f,g,h,i,j;return b=this.m[0]*a.m[0]+this.m[1]*a.m[3]+this.m[2]*a.m[6],c=this.m[0]*a.m[1]+this.m[1]*a.m[4]+this.m[2]*a.m[7],d=this.m[0]*a.m[2]+this.m[1]*a.m[5]+this.m[2]*a.m[8],e=this.m[3]*a.m[0]+this.m[4]*a.m[3]+this.m[5]*a.m[6],f=this.m[3]*a.m[1]+this.m[4]*a.m[4]+this.m[5]*a.m[7],g=this.m[3]*a.m[2]+this.m[4]*a.m[5]+this.m[5]*a.m[8],h=this.m[6]*a.m[0]+this.m[7]*a.m[3]+this.m[8]*a.m[6],i=this.m[6]*a.m[1]+this.m[7]*a.m[4]+this.m[8]*a.m[7],j=this.m[6]*a.m[2]+this.m[7]*a.m[5]+this.m[8]*a.m[8],this.m=[b,c,d,e,f,g,h,i,j],this},JPRO.Matrix.prototype.xMatrix4=function(a){return this.col4.acc(this.xVec(a.col4)),this.xMatrix(a)},JPRO.Matrix.prototype.xVec=function(a){var b=a.getX(),c=a.getY(),d=a.getZ();return new JPRO.Vec(this.m[0]*b+this.m[1]*c+this.m[2]*d,this.m[3]*b+this.m[4]*c+this.m[5]*d,this.m[6]*b+this.m[7]*c+this.m[8]*d)},JPRO.Matrix.prototype.xVec4=function(a){return this.xVec(a).acc(this.col4)},JPRO.Matrix.prototype.xV=function(a){var b=a.getX(),c=a.getY(),d=a.getZ();return a.x=this.m[0]*b+this.m[1]*c+this.m[2]*d,a.y=this.m[3]*b+this.m[4]*c+this.m[5]*d,a.z=this.m[6]*b+this.m[7]*c+this.m[8]*d,this},JPRO.Matrix.prototype.toString=function(){return"[["+this.m[0]+","+this.m[1]+","+this.m[2]+"], ["+this.m[3]+","+this.m[4]+","+this.m[5]+"], ["+this.m[6]+","+this.m[7]+","+this.m[8]+"]]"},JPRO.Matrix.transpose=function(a){var b,c,d=a[0].length,e=[],f=[];for(c=0;d>c;c++){for(f=[],b=0;b<a.length;b++)f.push(a[b][c]);e.push(f)}return e}}(),function(){"use strict";JPRO.Rmatrix=function(a,b){this.degrees=a||0,this.axis=b||JPRO.XAXIS;var c=a*PIXI.DEG_TO_RAD,d=Math.sin(c),e=Math.cos(c),f=[e,-d,0,d,e,0,0,0,1];b===JPRO.XAXIS?f=[1,0,0,0,e,-d,0,d,e]:b===JPRO.YAXIS&&(f=[e,0,d,0,1,0,-d,0,e]);var g=new JPRO.Vec(f[0],f[1],f[2]),h=new JPRO.Vec(f[3],f[4],f[5]),i=new JPRO.Vec(f[6],f[7],f[8]);this.className="Rmatrix",JPRO.Matrix.call(this,g,h,i)},JPRO.Rmatrix.prototype=Object.create(JPRO.Matrix.prototype),JPRO.Rmatrix.prototype.constructor=JPRO.Rmatrix}(),function(){"use strict";JPRO.ID.ThrowSeq=0,JPRO.ThrowSeq=function(a,b,c){this.className=this.className||"ThrowSeq",JPRO.Base.call(this,c),this.mhn=a?a:[[[[0,0]]]],this.rhMap=b,this.iters=1,this.rows=this.mhn.length,this.period=this.mhn[0].length,this.iterCnt=0,this.maxRows=10,this.maxPeriod=32,this.selectionOrder=0,this.selections=0,this.isSelected={},this.highThrowHeight=9,this.maxThrowHeight=19,this.beat=0},JPRO.ThrowSeq.prototype=Object.create(JPRO.Base.prototype),JPRO.ThrowSeq.prototype.constructor=JPRO.ThrowSeq,JPRO.ThrowSeq.prototype.copy=function(a,b){var c={};c.mhn=JPRO.Common.makeCopyMatrix(4);var d={};return d.selectionOrder=1,d.selections=1,d.isSelected=1,this.copyOnce(a,b,d,c)},JPRO.ThrowSeq.prototype.repeat=function(){return this.iters<0?1:this.iterCnt<this.iters-1?(this.iterCnt++,1):(this.iterCnt=0,null)},JPRO.ThrowSeq.prototype.getHand=function(a,b){return this.rhMap.getHand(a,b)},JPRO.ThrowSeq.prototype.nextBeat=function(){var a;return this.beat>=this.mhn[0].length-1?(this.beat=0,a=this.repeat()):(this.beat++,a=1),0!==this.iters&&this.rhMap.nextBeat(),a},JPRO.ThrowSeq.prototype.swap=function(a,b){var c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2],i=this.mhn[c][d][e],j=this.mhn[f][g][h],k=i[0],l=i[1]+d;this.mhn[f][g][h]=[k,l-g];var m=j[0],n=j[1]+g;return this.mhn[c][d][e]=[m,n-d],this},JPRO.ThrowSeq.prototype.clean=function(){var a,b;for(a=0;a<this.mhn.length;a++)for(b=0;b<this.mhn[a].length;b++)this.mhn[a][b]=this.cleanList(this.mhn[a][b],a)},JPRO.ThrowSeq.prototype.cleanList=function(a,b){for(var c,d=[];c=a.shift;)(0!==c[1]||c[0]!==b)&&d.push(c);return d===[]&&(d=[b,0]),d},JPRO.ThrowSeq.prototype.select=function(a,b,c){var d=a+","+b+","+c;this.isSelected[d]?(delete this.isSelected[d],this.selections--):(this.isSelected[d]=++this.selectionOrder,this.selections++)},JPRO.ThrowSeq.prototype.getSelectedThrows=function(){var a,b,c,d;a=[];for(b in this.isSelected){for(c=b.split(","),d=0;d<c.length;d++)c[d]=parseInt(c[d]);a.push(c)}return a},JPRO.ThrowSeq.prototype.clearSelections=function(){var a;for(a in this.isSelected)delete this.isSelected[a],this.selections--},JPRO.ThrowSeq.prototype.toHtml=function(){var a,b,c,d,e,f,g,h,i=this.mhn[0].length;for(f=2===this.selections?"":"disabled",d="<table><colgroup>",d+="<col span='1' id=\"first_col\">",d+="<col span='"+i+"'>",d+="<col span='1' id=\"last_col\">",d+="</colgroup>",d+="<tr><th></th>",d+="<th>0</th>",b=1;i>b;b++)d+="<th>"+b+"</th>";for(d+="<th>-</th>",d+="</tr>",a=0;a<this.mhn.length;a++){for(d+="<tr><td>",d+=this.toHandSymbol(a),d+="</td>",b=0;i>b;b++){for(d+="<td>",c=0;c<this.mhn[a][b].length;c++)g=this.mhn[a][b][c][0],h=this.mhn[a][b][c][1],c>0&&(d+=","),e=this.isSelected[a+","+b+","+c]?"#0022dd":h>this.maxThrowHeight||0>h||0===h&&g!==a?"red":h>this.highThrowHeight?"yellow":"black",d+='<span style="background-color:'+e+'" onclick="JPRO._table('+a+","+b+","+c+')">',d+=this.toHandSymbol(g),d+=h,d+="</span>";d+="</td>"}d+="<td>",d+="</td>",d+="</tr>"}for(d+='<tr style="background-color:#505050">',d+="<td>",d+=this.toHandSymbol(this.mhn.length),d+="</td>",d+='<td><button onclick="JPRO._swap()"'+f+"> Swap </button></td>",b=1;i>b;b++)d+="<td></td>";return d+="<td></td>",d+="</tr>",d+="</table>"},JPRO.ThrowSeq.prototype.toHandSymbol=function(a){return String.fromCharCode(65+a)},JPRO.ThrowSeq.prototype.toString=function(a){var b,c,d,e,f;for(f=a,(null===a||void 0===a)&&(f=this.mhn),b="[",c=0;c<f.length;c++){for(c>0&&(b+=", "),b+="[",d=0;d<f[c].length;d++){for(d>0&&(b+=", "),b+="[",e=0;e<f[c][d].length;e++)e>0&&(b+=", "),b=b.concat("["),b=b.concat(f[c][d][e][0]),b=b.concat(","),b=b.concat(f[c][d][e][1]),b=b.concat("]");b+="]"}b+="]"}return b+="]"}}(),function(){"use strict";JPRO.ID.Pattern=0,JPRO.Pattern=function(a,b,c,d){this.className=this.className||"Pattern",JPRO.ThrowSeq.call(this,a,b,d),this.iters=void 0===c?-1:c,this.iterCnt=0,this.props=this.calcProps()},JPRO.Pattern.prototype=Object.create(JPRO.ThrowSeq.prototype),JPRO.Pattern.prototype.constructor=JPRO.Pattern,JPRO.Pattern.prototype.setPeriodRows=function(a,b){return a&&(this.period=a),b&&(this.rows=b),this.mhn=this.genMhn(this.rows,this.period),this.props=this.calcProps(),this.rowBeats=this.makeArray(this.rows),this},JPRO.Pattern.prototype.genMhn=function(a,b){var c,d,e,f,g=[];for(e=0;a>e;e++){for(d=[],f=0;b>f;f++)c=[[e,0]],d.push(c);g.push(d)}return g},JPRO.Pattern.prototype.makeArray=function(a,b){var c,d=b||0,e=[];for(c=a-1;c>=0;c--)e[c]=d;return e},JPRO.Pattern.prototype.translateAll=function(a){var b,c,d,e=void 0===a?1:a,f=0;for(b=0;b<this.rows;b++)for(c=0;c<this.period;c++)for(d=0;d<this.mhn[b][c].length;d++)this.mhn[b][c][d][1]+=e,f+=e;return this.props+=Math.round(f/this.period),this},JPRO.Pattern.prototype.translateThrow=function(a,b){var c=a[0],d=a[1],e=a[2],f=void 0===b?1:b;return this.mhn[c][d][e][1]+=f*this.period,this.props+=f,this},JPRO.Pattern.prototype.translateThrowsSelected=function(a){var b,c;for(b=this.getSelectedThrows(),c=0;c<b.length;c++)this.translateThrow(b[c],a);return this},JPRO.Pattern.prototype.multiplexTranslate=function(a,b){var c,d=a||0,e=void 0===b?1:b;if(this.mhn[d][0].length>=4)return alert("No more than 4 multiplex slots allowed per row"),this;for(c=0;c<this.period;c++)this.mhn[d][c].push([d,e]);return this.props+=e,this},JPRO.Pattern.prototype.rotateThrows=function(a){var b;for(b=0;b<this.rows;b++)this.mhn[b]=this.rotateRow(a,this.mhn[b]);return this},JPRO.Pattern.prototype.rotateRow=function(a,b){var c,d,e=[];for(c=b.length-1;c>=0;c--)d=(c+a)%b.length,e[c]=b[d];return e},JPRO.Pattern.prototype.rotateRows=function(a){var b,c;if(this.rows<2)return this;var d=this.mhn.slice(0);for(b=0;b<this.rows;b++)c=(b+a+this.rows)%this.rows,this.mhn[b]=this.rotateRowsAdjust(d[c],b-c,this.rows);return this},JPRO.Pattern.prototype.rotateRowsAdjust=function(a,b,c){var d,e;for(d=0;d<a.length;d++)for(e=0;e<a[d].length;e++)a[d][e][0]=(a[d][e][0]+b+c)%c;return a},JPRO.Pattern.prototype.extendPeriod=function(){var a,b,c,d,e,f,g,h=0,i=0;if(this.period>=this.maxPeriod)return alert("Period upper limit is "+this.maxPeriod),this;for(;h<this.props*this.period;){for(a=0;a<this.period;a++)for(b=0;b<this.rows;b++)for(c=0;c<this.mhn[b][a].length;c++)this.mhn[b][a][c][1]-=1,h++;i++}for(g=h>this.props*this.period?1:0,a=0;a<this.period;a++)for(b=0;b<this.rows;b++)for(c=0;c<this.mhn[b][a].length;c++)d=this.mhn[b][a][c][1]+a+g,e=Math.floor(d/this.period),this.mhn[b][a][c][1]+=e+i;for(b=0;b<this.rows;b++){for(f=[],c=0;c<this.mhn[b][0].length;c++)f.push([b,i-g]);this.mhn[b].push(f)}return this.period++,this},JPRO.Pattern.prototype.extendRows=function(a){var b,c=a||0,d=[];if(this.rows>=this.maxRows)return alert("Rows upper limit is "+this.maxRows),this;for(b=0;b<this.period;b++)d.push([[this.rows,c]]);return this.mhn.push(d),this.rows++,this},JPRO.Pattern.prototype.reset=function(){this.period=1,this.rows=1,this.mhn=[[[[0,0]]]],this.props=0},JPRO.Pattern.prototype.calcProps=function(){var a,b,c,d,e;for(d=0,a=0;a<this.rows;a++)for(b=0;b<this.period;b++)for(c=0;c<this.mhn[a][b].length;c++)d+=this.mhn[a][b][c][1];return e=d/this.period,Math.round(e)},JPRO.Pattern.prototype.toHtml=function(){var a,b,c,d,e,f,g,h,i;for(f=2===this.selections?"":"disabled",g=this.selections?"JPRO._ts":"JPRO._ta",d="<table><colgroup>",d+="<col span='1' id=\"first_col\">",d+="<col span='"+this.period+"'>",d+="<col span='1' id=\"last_col\">",d+="</colgroup>",d+='<tr><th><button onclick="JPRO._ac()">AC</button></th>',d+='<th><button onclick="'+g+'(1)">0<sup>+</sup></button></th>',b=1;b<this.period;b++)d+='<th><button onclick="JPRO._rt('+b+')">'+b+"</button></th>";for(d+='<th><button onclick="JPRO._ep()">'+this.period+"</button></th>",d+="</tr>",g+="(-1)",a=0;a<this.rows;a++){for(d+="<tr><td><button onclick='"+g+"'>",g="JPRO._rr("+(a+1)+")",d+=this.toHandSymbol(a),0===a&&(d+="<sup>-</sup>"),d+="</button></td>",b=0;b<this.period;b++){for(d+="<td>",c=0;c<this.mhn[a][b].length;c++)h=this.mhn[a][b][c][0],i=this.mhn[a][b][c][1],c>0&&(d+=","),e=this.isSelected[a+","+b+","+c]?"#0022dd":i>this.maxThrowHeight||0>i||0===i&&h!==a?"red":i>this.highThrowHeight?"yellow":"black",d+='<span style="background-color:'+e+'" onclick="JPRO._table('+a+","+b+","+c+')">',d+=this.toHandSymbol(h),d+=i,d+="</span>";d+="</td>"}d+="<td>",d+='<button onclick="JPRO._mp('+a+')"> Multiplex </button>',d+="</td>",d+="</tr>"}for(d+='<tr style="background-color:#505050">',d+='<td><button onclick="JPRO._er()">',d+=this.toHandSymbol(this.rows),d+="</button></td>",d+='<td><button onclick="JPRO._swap()"'+f+"> Swap </button></td>",b=1;b<this.period;b++)d+="<td></td>";return d+='<td><button onclick="JPRO._reset()"> Reset </button></td>',d+="</tr>",d+="</table>"},JPRO.Pattern.prototype.getTransition=function(a){var b=new JPRO.State(a.mhn,a.props),c=new JPRO.State(this.mhn,this.props);return c.getTransition(b)},JPRO._ac=function(){viewer.pattern.clearSelections(),$("#div1").html(viewer.pattern.toHtml())},JPRO._ta=function(a){viewer.pattern.translateAll(a),$("#div1").html(viewer.pattern.toHtml())},JPRO._ts=function(a){viewer.pattern.translateThrowsSelected(a),viewer.pattern.clearSelections(),$("#div1").html(viewer.pattern.toHtml())},JPRO._rt=function(a){viewer.pattern.rotateThrows(a),$("#div1").html(viewer.pattern.toHtml())},JPRO._ep=function(){viewer.pattern.extendPeriod(),$("#div1").html(viewer.pattern.toHtml())},JPRO._mp=function(a){viewer.pattern.multiplexTranslate(a,1),viewer.pattern.clearSelections(),$("#div1").html(viewer.pattern.toHtml())},JPRO._rr=function(a){viewer.pattern.rotateRows(a),$("#div1").html(viewer.pattern.toHtml())},JPRO._er=function(){viewer.pattern.extendRows(0),$("#div1").html(viewer.pattern.toHtml())},JPRO._swap=function(){var a=viewer.pattern.getSelectedThrows();viewer.pattern.swap(a[0],a[1]),viewer.pattern.clearSelections(),$("#div1").html(viewer.pattern.toHtml())},JPRO._table=function(a,b,c){viewer.pattern.select(a,b,c),$("#div1").html(viewer.pattern.toHtml())},JPRO._reset=function(){viewer.pattern.reset(),$("#div1").html(viewer.pattern.toHtml())}}(),JPRO.ID.Routine=0,JPRO.Routine=function(a,b,c){this.className=this.className||"Routine",JPRO.Base.call(this,c),this.patterns=void 0===a?[]:a,this.currentIdx=0,this.patternIdx=0,this.iters=void 0===b?-1:b,this.iterCnt=0,this.viewer=null,this.enable=1,this.entryCB=function(){},this.exitCB=function(){}},JPRO.Routine.prototype=Object.create(JPRO.Base.prototype),JPRO.Routine.prototype.constructor=JPRO.Routine,JPRO.Routine.prototype.copy=function(a,b){var c={};c.patterns=JPRO.Common.copyObjVector;var d=["entryCB","exitCB"];return this.copyOnce(a,b,{},c,d)},JPRO.Routine.prototype.pushPat=function(a){return this.patterns.push(a),this},JPRO.Routine.prototype.nextPat=function(a,b,c){var d,e,f,g,h,i;if(null===this.enable)return this.enable=1,null;if(h=b?b:0,h>99)throw this.enable=null,"exceeded recursive limit";if(a&&(this.viewer=a),i=c||0,0===this.iters)return this.enable=null,null;for(e=0,d=this.patternIdx,0===this.iterCnt&&0===d&&this.entryCB(i);e<this.patterns.length&&0===this.patterns[d].iters;)d++,d>=this.patterns.length&&(d=0,this.iters>0&&this.iterCnt++),e++;if(e===this.patterns.length)throw"routine has no iterable pattern in it";if(f=this.patterns[d],this.patternIdx=d,"Routine"===f.className){if(g=f.nextPat(this.viewer,h+1,i))return this.currentIdx=this.patternIdx,g;
f.enable=1,g=null}else g=f,this.currentIdx=this.patternIdx;return d++,d>=this.patterns.length&&(d=0,(this.iters>0||0===this.iterCnt)&&this.iterCnt++),this.patternIdx=d,this.iters>0&&this.iterCnt>=this.iters?(this.iterCnt=0,this.enable=null,this.exitCB(i),g):null===g?this.nextPat(this.viewer,h+1,i):g},JPRO.Routine.prototype.toString=function(){var a,b=this.patterns,c="[";for(a=0;a<b.length;a++)a>0&&(c+=", "),c+=b[a].toString();return c+="]"},function(){"use strict";JPRO.State=function(a,b){this.mhn=a,this.props=b;var c=function(a,b){var c,e,f,g,h,i,j,k,l=b,m=[[]];for(k=d(a),console.log("maxThrowHeight="+k),c=0;c<a.length;c++)for(j=1;l>0;){if(j>k)return void console.log("State: ERROR - Unable to determine state for MHN pattern");for(e=a[c].length-1;e>=0;e--){for(f=0;f<a[c][e].length;f++)g=a[c][e][f][0],h=a[c][e][f][1],i=h-j,console.log("i="+c+" j="+e+" k="+f+" th="+h+" scol="+i),i>=0&&(void 0===m[g]||void 0===m[g][i]?m[g][i]=1:m[g][i]++,l--);j++}}return m},d=function(a){var b,c,d,e,f=0;for(b=0;b<a.length;b++)for(c=0;c<a[b].length;c++)for(d=0;d<a[b][c].length;d++)e=a[b][c][d][1],e>f&&(f=e);return f};this.state=c(a,b)},JPRO.State.prototype.constructor=JPRO.State,JPRO.State.prototype.incr=function(a,b){return void 0===this.state[a]?(this.state[a]=[],void(this.state[a][b]=1)):void 0===this.state[a][b]?void(this.state[a][b]=1):void this.state[a][b]++},JPRO.State.prototype.makeThrow=function(a,b,c){console.log("makeThrow called with row="+a+" destRow="+b+" th="+c);var d=this.state[a][0];if(void 0===d||0===d){if(c>0)return void console.log("makeThrow: ERROR - throw-height must be 0 for row "+a)}else{if(0===c)return void console.log("makeThrow: ERROR - throw-height must be positive for row "+a);d--,this.state[a][0]=d,this.incr(b,c)}this.firstColIsZero()&&this.nextState()},JPRO.State.prototype.firstColIsZero=function(a){var b,c;for(null===a&&(a=this.state),b=0;b<a.length;b++)if(c=this.toInt(a[b][0]),c>0)return null;return 1},JPRO.State.prototype.nextState=function(a){var b,c;for(null===a&&(a=this.state),b=0;b<a.length;b++)c=a[b].shift()},JPRO.State.prototype.equals=function(a){var b,c,d=this.state,e=a.state;if(d.length!==e.length)return console.log("rows not equal:"+d.length+" !== "+e.length),0;for(b=0;b<d.length;b++){if(d[b].length!==e[b].length)return console.log("cols not equal:"+d[b].length+" !== "+e[b].length+" for row "+b),0;for(c=0;c<d[b].length;c++)if(void 0===d[b][c]&&(d[b][c]=0),void 0===e[b][c]&&(e[b][c]=0),d[b][c]!==e[b][c])return 0}return 1},JPRO.State.prototype.getTransition=function(a){var b,c,d,e=[],f=this.copy().state,g=a.state;for(b=0;b<f.length;b++)e.push([]);for(;this.firstColIsZero(f);)for(this.nextState(f),b=0;b<f.length;b++)e[b].push([[b,0]]);console.log("0 transSeq = "+this.mhnToString(e));var h=this.getHeight(),i=a.getHeight(),j=h-i;for(0>j&&(j=1),console.log("csh="+h+" tsh="+i+" tlen="+j),c=h-1,d=c-j;c>=j&&this.unreachable(f,c,g,d);)j++,d=c-j;return console.log("tlen="+j),e=this.pushTransThrows(e,f,g,j),console.log("1 transSeq = "+this.mhnToString(e)),new JPRO.ThrowSeq(e)},JPRO.State.prototype.unreachable=function(a,b,c,d){var e,f,g,h,i=b;for(f=d;f>=0;f--){for(e=0;e<c.length;e++)if(g=this.toInt(a[e][i]),h=this.toInt(c[e][f]),g>h)return 1;i--}return console.log("target state is reachable without having to go through ground state"),0},JPRO.State.prototype.toInt=function(a){return void 0===a?0:a},JPRO.State.prototype.pushTransThrows=function(a,b,c,d){var e,f,g,h,i,j,k,l=[];if(0===d)return a;for(e=0;e<b.length;e++)l.push([]);for(f=1;d>f;f++)for(e=0;e<b.length;e++)if(0===this.toInt(b[e][f]))for(g=0;f>g;g++)if(this.toInt(b[e][g])>0){b[e][g]--,b[e][f]=1,void 0===l[e][g]?l[e][g]=[[e,f-g]]:l[e][g].push([e,f-g]);break}for(console.log("0 transSeqTmp = "+this.mhnToString(l)),f=0;f<c[0].length;f++)for(e=0;e<c.length;e++)for(g=f+d,b[e][g]=this.toInt(b[e][g]),h=this.toInt(c[e][f])-b[e][g];h>0;)k=this.findThrow(b,d),i=k[0],j=k[1],b[i][j]=this.toInt(b[i][j])-1,b[e][g]++,console.log("From ii="+i+" jj="+j),console.log("  To  i="+e+"  k="+g),void 0===l[i][j]?l[i][j]=[[e,g-j]]:l[i][j].push([e,g-j]),h--;for(console.log("1 transSeqTmp = "+this.mhnToString(l)),e=0;e<a.length;e++)a[e]=a[e].concat(l[e]);return a},JPRO.State.prototype.findThrow=function(a,b){var c,d;for(d=0;b>d;d++)for(c=0;c<a.length;c++)if(a[c][d]>0)return[c,d];console.log("findThrow: ERROR - No balls left in cs to throw")},JPRO.State.prototype.getHeight=function(){var a,b,c,d=this.state;for(c=0,a=0;a<d.length;a++)b=d[a].length,b>c&&(c=b);return c},JPRO.State.prototype.getMaxThrowHeight=function(a){var b,c,d,e,f=0;for(b=0;b<a.length;b++)for(c=0;c<a[b].length;c++)for(d=0;d<a[b][c].length;d++)e=a[b][c][d][1],e>f&&(f=e);return f},JPRO.State.prototype.toString=function(){var a,b,c,d="[";for(a=0;a<this.state.length;a++){for(a>0&&(d+=",<br>\n"),d+="[",b=0;b<this.state[a].length;b++)b>0&&(d+=", "),c=this.state[a][b],c=void 0===c?"0":c,d+=c;d+="]"}return d+="]"},JPRO.State.prototype.mhnToString=function(a){var b,c,d,e;for(e="[",b=0;b<a.length;b++){for(b>0&&(e+=", "),e+="[",c=0;c<a[b].length;c++){for(c>0&&(e+=", "),e+="[",d=0;d<a[b][c].length;d++)d>0&&(e+=", "),e=e.concat("["),e=e.concat(a[b][c][d][0]),e=e.concat(","),e=e.concat(a[b][c][d][1]),e=e.concat("]");e+="]"}e+="]"}return e+="]"},JPRO.State.prototype.copy=function(){var a,b=new JPRO.State(this.mhn,this.props);for(b.state=[],a=0;a<this.state.length;a++)b.state[a]=this.state[a].slice(0);return b}}(),function(){"use strict";JPRO.Prop=function(a,b){this.viewer=a,this.viewer&&(this.view=this.viewer.view),this.pos=b||new JPRO.Vec,this.vel=new JPRO.Vec,this.posProjected=null,this.inHand=null,this.timer=0,this.destHand=null,this.inPlay=null},JPRO.Prop.prototype.constructor=JPRO.Prop,JPRO.Prop.prototype.updatePos=function(a){var b=a||0;return null===this.inPlay?this:(this.inHand?this.pos.setV(this.inHand.pos):this.pos.acc(this.vel.acc(this.view.g)),this.posProjected=this.view.project(this.pos),0===b&&this.timer>0&&(this.timer--,this.timer<=0&&this.caughtBy(this.destHand)),this)},JPRO.Prop.prototype.throw2Pos=function(a,b){var c=this.pos,d=(a.x-c.x)/b-b*this.view.g.x/2,e=(a.y-c.y)/b-b*this.view.g.y/2,f=(a.z-c.z)/b-b*this.view.g.z/2;return this.vel.set(d,e,f),this.inHand=null,this.timer=b,this},JPRO.Prop.prototype.throw2Hand=function(a){return this.destHand=a.destHand,this.timer=a.timer,this.vel.setV(a.vel),this.inHand=null,this},JPRO.Prop.prototype.caughtBy=function(a,b){var c=b||0;return this.inHand=a,0===c&&a.catchProp(this,1),this.pos.setV(a.pos),this}}(),function(){"use strict";JPRO.Ball=function(a,b,c,d){function e(a,b,c){var d,e,f,g,h,i,j,k=[],l=20,m=[.75,.65,.55,.35,.2,.13,.08,.03,.02],n=[.09,.11,.15,.2,.25,.3,.35,.4,.45];for(j=0;l>j;j++){for(i=b-j,f=i+1,g=Math.round(f-.3*i),h=Math.round(f-.3*i),a.clear(),a.beginFill(c),a.drawCircle(f,f,i),a.endFill(),e=8;e>=0;e--)a.beginFill(c),a.drawCircle(g,h,i*n[e]),a.endFill(),a.beginFill(16777215,m[e]),a.drawCircle(g,h,i*n[e]),a.endFill();d=new JPRO.Sprite3D(a.generateTexture()),d.anchor.x=0,d.anchor.y=0,k.push(d)}return k}JPRO.Prop.call(this,a,b||new JPRO.Vec),this.radius=d||40,this.color=c||16777215,this.grfx=this.viewer.grfx,this.lastDidx=-1,this.mySprites=e(this.grfx,this.radius,this.color)},JPRO.Ball.prototype=Object.create(JPRO.Prop.prototype),JPRO.Ball.prototype.constructor=JPRO.Ball,JPRO.Ball.prototype.update=function(){var a,b,c,d,e;return null===this.inPlay?(this.lastDidx>=0&&this.viewer.stage.removeChild(this.mySprites[this.lastDidx]),this.lastDidx=-1,this):(this.updatePos(),a=this.posProjected.getX(),b=this.posProjected.getY(),c=this.posProjected.getZ()*this.radius,d=Math.round(this.radius-c),d>19&&(d=19),this.mySprites[d].depth=this.posProjected.getZ(),e=this.radius+1-d,this.mySprites[d].position.x=a-e,this.mySprites[d].position.y=b-e,d!==this.lastDidx&&(this.lastDidx>=0&&this.viewer.stage.removeChild(this.mySprites[this.lastDidx]),d>=0&&this.mySprites[d].add2Stage(this.viewer.stage),this.lastDidx=d),this)},JPRO.Ball.prototype.removeMe=function(){this.lastDidx>=0&&this.viewer.stage.removeChild(this.mySprites[this.lastDidx])}}(),function(){"use strict";JPRO.Sprite3D=function(a){PIXI.Sprite.call(this,a),this.depth=0},JPRO.Sprite3D.prototype=Object.create(PIXI.Sprite.prototype),JPRO.Sprite3D.prototype.constructor=JPRO.Sprite3D,JPRO.Sprite3D.prototype.add2Stage=function(a){a.addChildAt(this,this.add2StageGetIdx(a))},JPRO.Sprite3D.prototype.add2StageGetIdx=function(a){for(var b=a.children.length,c=this.depth,d=0;b>d;){if(c<a.children[d].depth)return d;d++}return b},JPRO.Sprite3D.fromImage=function(a,b,c){var d=PIXI.Texture.fromImage(a,b,c);return new JPRO.Sprite3D(d)}}(),JPRO.ID.Clock=0,JPRO.Clock=function(a,b,c,d){this.className=this.className||"Clock",JPRO.Base.call(this,c),this.basePeriod=a||20,this.rhythm=b||new JPRO.Rhythm,this.t=0,this.tt=0,this.maxTime=3e4,this.timeStamps={},this.beatPeriod=void 0===d?this.rhythm.nextBeat()*this.basePeriod:d},JPRO.Clock.prototype=Object.create(JPRO.Base.prototype),JPRO.Clock.prototype.constructor=JPRO.Clock,JPRO.Clock.prototype.copy=function(a,b){var c={};return c.timeStamps=JPRO.Common.copyHash,b=b||function(){return new JPRO.Clock(null,1,null,1)},this.copyOnce(a,b,{},c)},JPRO.Clock.prototype.update=function(){return this.t>=this.beatPeriod-1?(this.t=0,this.tt+=this.beatPeriod,this.tt>=this.maxTime&&(this.tt-=this.maxTime,this.adjustTimeStamps(this.maxTime)),this.beatPeriod=this.rhythm.nextBeat()*this.basePeriod,console.log("beatPeriod = "+this.beatPeriod),1):(this.t++,null)},JPRO.Clock.prototype.totalTime=function(){return this.tt+this.t},JPRO.Clock.prototype.adjustTimeStamps=function(a){var b;for(b in this.timeStamps)this.timeStamps[b]-=a},JPRO.Clock.prototype.timeStamp=function(a){return this.timeStamps[a]=this.totalTime(),this.timeStamps[a]},JPRO.Clock.prototype.getTimeStamp=function(a){return void 0===this.timeStamps[a]?0:this.timeStamps[a]},JPRO.Clock.prototype.duration=function(a){return void 0===this.timeStamps[a]?0:this.totalTime()-this.timeStamps[a]},JPRO.Clock.prototype.deleteTimeStamp=function(a){delete this.timeStamps[a]},JPRO.ID.Rhythm=0,JPRO.Rhythm=function(a,b,c,d,e){this.className=this.className||"Rhythm",JPRO.Base.call(this,e),this.rhythms=a||[1],this.iters=void 0===b?-1:b,this.idx=c||0,this.iter=d||0},JPRO.Rhythm.prototype=Object.create(JPRO.Base.prototype),JPRO.Rhythm.prototype.constructor=JPRO.Rhythm,JPRO.Rhythm.prototype.copy=function(a,b){var c,d,e,f;f=[];var g={};g.rhythms=1;var h=this.copyOnce(a,b,g);for(c in this.rhythms)if(d=this.rhythms[c],e=typeof d,"object"===e)f.push(d.copy(a));else{if("number"!==e)throw"Array element neither a number nor an object";f.push(d)}return h.rhythms=f,h},JPRO.Rhythm.prototype.nextBeat=function(a){if(a=a||0,a>99)throw"Exceeded recursive limit of 99";var b=null;if(this.iters>=0&&this.iter>=this.iters)return this.iter=0,null;var c=this.rhythms[this.idx],d=typeof c;if("number"===d)return this.nextIdx(),c;if("object"===d)return b=c.nextBeat(a+1),b?b:this.nextIdx().nextBeat(a+1);throw"Array element neither a number nor an object"},JPRO.Rhythm.prototype.nextIdx=function(){return this.idx>=this.rhythms.length-1?(this.idx=0,this.iters>=0&&this.iter++):this.idx++,this},JPRO.Rhythm.prototype.toString=function(){var a,b,c,d;d="{";for(a in this.rhythms)if(b=this.rhythms[a],c=typeof b,"number"===c)d=d+b+",";else{if("object"!==c)throw"Array element neither a number nor an object";d=d+"{"+b.toString()+"},"}return d=d.slice(0,d.length-1),d=d+"}x"+this.iters},JPRO.ID.Config=0,JPRO.Config=function(a){this.className=this.className||"Config",JPRO.Base.call(this,a)},JPRO.Config.prototype=Object.create(JPRO.Base.prototype),JPRO.Config.prototype.constructor=JPRO.Config,JPRO.Config.prototype.copy=function(a,b){var c={};c.jugglers=JPRO.Common.copyObjVector;var d=["dwellRatio","basePeriod","minThrowTime","viewWidth","viewHeight","view","viewAngle","zoomDistance","zoomIn","zoomOut"],e=["clock","gravity","view","aerialTurn","routine","pattern"];return this.directedCopy(a,b,c,d,e)},JPRO.Config.prototype.setDefaults=function(){if(void 0===this.stageColor&&(this.stageColor=0),void 0===this.stage&&(this.stage=new PIXI.Stage(this.stageColor)),void 0===this.grfx&&(this.grfx=new PIXI.Graphics,this.grfx.setStageReference(this.stage),this.stage.addChild(this.grfx)),void 0===this.dwellRatio&&(this.dwellRatio=.5),void 0===this.basePeriod&&(this.basePeriod=40),void 0===this.clock?this.clock=new JPRO.Clock(this.basePeriod):this.basePeriod=this.clock.basePeriod,this.minThrowTime=(this.clock.basePeriod>>1)+1,void 0===this.gravity&&(this.gravity=new JPRO.Vec(0,0,-8)),void 0===this.gui&&(this.gui=new JPRO.Gui(this)),void 0===this.viewWidth&&(this.viewWidth=800),void 0===this.viewHeight&&(this.viewHeight=600),void 0===this.view&&(this.view=new JPRO.View(this)),void 0===this.viewAngle&&(this.viewAngle=0),void 0===this.zoomDistance&&(this.zoomDistance=4500),void 0===this.jugglers&&(this.jugglers=[new JPRO.Juggler(this)]),void 0===this.routine){var a=new JPRO.RowHandMapper(null,[[this.jugglers[0].hands[0],this.jugglers[0].hands[1]]]),b=new JPRO.Pattern([[[[0,3]]]],a,1,"pat");this.routine=new JPRO.Routine([b],-1,"topRoutine")}},JPRO.ThrowData=function(a,b,c){this.pos=a,this.destHand=null,this.destRow=b,this.throwHeight=c,this.vel=new JPRO.Vec,this.timer=0,this.catchTime=0},JPRO.ThrowData.prototype.constructor=JPRO.ThrowData,JPRO.ThrowData.prototype.nextBeat=function(){return this.throwHeight>=0&&this.throwHeight--,this.throwHeight},JPRO.ThrowData.prototype.setVel=function(a,b){var c=this.timer,d=this.pos,e=(a.x-d.x)/c-c*b.x/2,f=(a.y-d.y)/c-c*b.y/2,g=(a.z-d.z)/c-c*b.z/2;this.vel.set(e,f,g)},JPRO.LookAhead=function(a){this.viewer=a,this.tdm=[],this.tbt=[],this.objHash1={},this.v1=a.copy(this.objHash1)},JPRO.LookAhead.prototype.constructor=JPRO.LookAhead,JPRO.LookAhead.prototype.preCalculate=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s={},t={};if(!(this.tdm.length>2)){var u=this.v1.pattern,v=[];for(a=0;a<u.rows;a++)for(b=u.mhn[a][u.beat],c=u.rhMap.getHand(a),p=this.objHash1[c.name].name,this.v1.clock.timeStamp(p),v.push([]),d=0;d<b.length;d++)b[d][1]>0&&(e=b[d][0],f=b[d][1],v[a].push(new JPRO.ThrowData(c.pos,e,f)));this.tdm.push(v),this.objHash2={};var w=this.v1.copy(this.objHash2);w.clock.timeStamp("current");var x=w.pattern;for(a=0;a<w.jugglers.length;a++)for(d=0;d<w.jugglers[a].hands.length;d++)t[w.jugglers[a].hands[d].name]=null;for(a=0;a<x.rows;a++)c=x.rhMap.getHand(a),p=this.origObj(c).name,w.clock.timeStamp(p);for(var y=null,z=null;!y||!z;){for(z=1,w.nextBeat(),x=w.pattern,a=0;a<v.length;a++)for(d=0;d<v[a].length;d++)o=v[a][d],f=o.nextBeat(),f>0?z=null:0===f&&(g=x.rhMap.getHand(o.destRow),o.destHand=this.origObj(g),h=w.clock.duration("current"),i=g.dwellRatio,r=w.clock.duration(o.destHand.name),j=i*r,h-=j,k=w.minThrowTime,k>h&&(h=k),o.timer=h,o.catchTime=w.clock.getTimeStamp("current")+h);for(a=0;a<x.rows;a++)b=x.mhn[a][x.beat],c=x.rhMap.getHand(a),p=this.origObj(c).name,t[c.name]||(s[p]=w.clock.duration(p),t[c.name]=1),w.clock.timeStamp(p);for(y=1,a=0;a<w.jugglers.length;a++)for(d=0;d<w.jugglers[a].hands.length;d++)q=w.jugglers[a].hands[d].name,t[q]||(y=null)}for(this.tbt.push(s),this.objHash2={},w=this.v1.copy(this.objHash2),w.clock.timeStamp("current"),x=w.pattern,z=null;!z;){for(z=1,a=0;a<v.length;a++)for(d=0;d<v[a].length;d++)o=v[a][d],o.catchTime<w.clock.tt+w.clock.beatPeriod?(g=this.objHash2[this.objHash1[o.destHand.name].name],l=g.movementBeat,i=g.dwellRatio,console.log("EWC: mBeat="+l+" dwellRatio="+i),console.log("EWC: destHand="+g.name+" hFunc="+g.hFunc.name),console.log("EWC: tt="+w.clock.tt+" i="+a),m=g.hFunc.getPos(1-i,l),n=w.view.transform(m[0]),console.log("EWC: pos="+n.toString()),o.setVel(n,w.view.g)):z=null;w.nextBeat()}this.v1.nextBeat()}},JPRO.LookAhead.prototype.origObj=function(a){return this.objHash1[this.objHash2[a.name].name]},JPRO.LookAhead.prototype.getTimeBetweenThrows=function(){return this.tbt.shift()},JPRO.LookAhead.prototype.getThrowDataMatrix=function(){return this.tdm.shift()},function(){"use strict";JPRO.View=function(a){this.viewer=a,this.name="view",this.width=a.width||800,this.height=a.height||600,this.origin=new JPRO.Vec(this.width/2,0,this.height/2),this.rot=new JPRO.Matrix,this.translation=new JPRO.Vec,this.scale=a.scale||4,this.g=a.gravity||new JPRO.Vec(0,0,-4),this.worldRot=[this.g],this.worldPos=[],this.depthOffset=400,this.focalDistance=1e3},JPRO.View.prototype.constructor=JPRO.View,JPRO.View.prototype.copy=function(a){if(void 0===a&&(a={}),void 0!==a[this.name])return a[this.name];var b=new JPRO.View(this.viewer.copy(a));return b.name=this.name+"_copy",a[this.name]=b,a[b.name]=this,b.width=this.width,b.height=this.height,b.origin=this.origin,b.rot=this.rot.copy(a),b.translation=this.translation.copy(a),b.scale=this.scale,b.g=this.g.copy(a),b.worldRot=JPRO.Common.copyObjVector(this.worldRot,a),b.worldPos=JPRO.Common.copyObjVector(this.worldPos,a),b.depthOffset=this.depthOffset,b.focalDistance=this.focalDistance,b},JPRO.View.prototype.transform=function(a){return this.rot.xVec(a).acc(this.translation)},JPRO.View.prototype.rotateMe=function(a){var b;for(this.rot.xMatrix(a),b=0;b<this.worldRot.length;b++)a.xV(this.worldRot[b]);for(b=0;b<this.worldPos.length;b++)a.xV(this.worldPos[b]);return this},JPRO.View.prototype.translateMe=function(a){var b;for(this.translation.acc(a),b=0;b<this.worldPos.length;b++)this.worldPos[b].acc(a)},JPRO.View.prototype.project=function(a){var b=this.depth2Dscale(this.origin.getY()+(a.getY()>>this.scale)),c=this.origin.getX()+(a.getX()>>this.scale)*b,d=this.height-(this.origin.getZ()+(a.getZ()>>this.scale)*b);return new JPRO.Vec(c,d,b)},JPRO.View.prototype.pushRvec=function(a){return this.worldRot.push(a),this},JPRO.View.prototype.pushPvec=function(a){return this.worldPos.push(a),this},JPRO.View.prototype.pushProp=function(a){return this.pushPvec(a.pos).pushRvec(a.vel),this},JPRO.View.prototype.depth2Dscale=function(a){var b,c=a+this.depthOffset;return 0>c&&(c=0),b=this.focalDistance/(this.focalDistance+c)}}(),JPRO.ID.Viewer=0,JPRO.Viewer=function(a){this.className=this.className||"Viewer",JPRO.Config.call(this,a),this.initVars(),this.testVar=0},JPRO.Viewer.prototype=Object.create(JPRO.Config.prototype),JPRO.Viewer.prototype.constructor=JPRO.Viewer,JPRO.Viewer.prototype.initVars=function(){this.renderer=null,this.pattern=null,this.ballColors=[12259771,1118685,1162001,14540032,15636736,14487825],this.ballSize=40,this.props=[],this.allProps=[],this.nprops=0,this.enable=1,this.rotEnable=null,this.rotPeriod=5,this.rotDeg=180,this.rotCnt=0,this.aerialTurn=null,this.zoomIn=null,this.zoomOut=null,this.lookAhead=null,this.timeBetweenThrows=null},JPRO.Viewer.prototype.init=function(){return this.initRotationMatrix(),this.initProps(),this.pattern=this.routine.nextPat(this),this.view.rotateMe(this.r1),this.view.translateMe(this.zoomOut),this.lookAhead=new JPRO.LookAhead(this),this.lookAhead.preCalculate(),this.timeBetweenThrows=this.lookAhead.getTimeBetweenThrows(),this.throwProps(this.pattern),this.gui.init(),this.initAnimation(),console.log("finished init"),this},JPRO.Viewer.prototype.initRotationMatrix=function(){var a=new JPRO.Rmatrix(1,2);this.r1=new JPRO.Rmatrix(-this.viewAngle,0);var b=new JPRO.Rmatrix(this.viewAngle,0);return this.aerialTurn=new JPRO.Matrix,this.aerialTurn.xMatrix(this.r1).xMatrix(a).xMatrix(b),this.zoomOut=new JPRO.Vec(0,this.zoomDistance,0),this.zoomIn=new JPRO.Vec(0,-this.zoomOut.y,0),this},JPRO.Viewer.prototype.initProps=function(){var a,b;for(this.nprops=30,a=0;a<this.nprops;a++)b=new JPRO.Ball(this,new JPRO.Vec,this.ballColors[a%this.ballColors.length],this.ballSize),this.props.push(b),this.allProps.push(b),this.view.pushProp(b);return this.grfx.clear(),this},JPRO.Viewer.prototype.initAnimation=function(){return this.renderer=PIXI.autoDetectRenderer(this.view.width,this.view.height),document.body.appendChild(this.renderer.view),this},JPRO.Viewer.prototype.grabNewProp=function(){var a;return console.log("grabbing new prop"),0===this.props.length?(console.log("No props left to grab!"),alert("No props left"),null):(a=this.props.pop(),a.inPlay=1,a)},JPRO.Viewer.prototype.dropProp=function(a){console.log("dropping a prop"),a.inPlay=null,a.inHand=null,this.props.push(a)},JPRO.Viewer.prototype.updateJugglers=function(){var a;for(a=0;a<this.jugglers.length;a++)this.jugglers[a].update(this.timeBetweenThrows);return this},JPRO.Viewer.prototype.updateProps=function(){var a;for(a=0;a<this.allProps.length;a++)this.allProps[a].update();return this},JPRO.Viewer.prototype.nextBeat=function(){var a;for(this.clock.t=this.clock.beatPeriod,this.clock.update(),a=0;a<this.jugglers.length;a++)this.jugglers[a].nextBeat();for(this.pattern.nextBeat()||(this.pattern=this.routine.nextPat(this,0,1)),a=0;a<this.jugglers.length;a++)this.jugglers[a].updatePos()},JPRO.Viewer.prototype.getDwell=function(a,b,c,d){return a.rhMap.getDwell(a,b,c,d)},JPRO.Viewer.prototype.throwProps=function(a){var b,c,d,e,f,g,h,i=this.lookAhead.getThrowDataMatrix();for(b=0;b<a.rows;b++){for(d=a.mhn[b][a.beat],f=a.rhMap.getHand(b),this.clock.timeStamp(f.name),g=0,c=0;c<d.length;c++)d[c][1]>0&&(h=i[b][c],e=d[c][0],console.log("destRow="+e),f.throwProp(h));f.nprops()>g&&f.dropProp(f.nprops()-g)}return this},JPRO.Viewer.prototype.update=function(){var a;if(this.grfx.clear(),this.updateJugglers().updateProps(),this.rotateViewWhenEnabled(this.aerialTurn,this.zoomIn,this.zoomOut),this.clock.update()){for(this.timeBetweenThrows=this.lookAhead.getTimeBetweenThrows(),this.pattern.nextBeat()||(this.pattern=this.routine.nextPat(this,0),console.log("Viewer: New pattern is "+this.pattern),$("#div1").html(this.pattern.toHtml())),a=0;a<this.jugglers.length;a++)this.jugglers[a].nextBeat();this.throwProps(this.pattern)}else this.lookAhead.preCalculate();return this.renderer.render(this.stage),this},JPRO.Viewer.prototype.rotateViewWhenEnabled=function(a,b,c){this.rotEnable&&(this.rotCnt++,this.rotCnt>this.rotPeriod&&(this.rotCnt=0,this.rotateView(a,b,c)))},JPRO.Viewer.prototype.rotateView=function(a,b,c){var d,e;return d=.3,this.view.translateMe(b),this.view.rotateMe(a),this.view.translateMe(c),this.rotDeg++,this.rotDeg>180&&(this.rotDeg-=360),e=this.rotDeg*PIXI.DEG_TO_RAD,this},JPRO.Viewer.prototype.getHandBeatsFromLastThrow=function(a,b,c){var d=b||0;void 0!==c&&(a=this.handToRow(c));var e=this.rhm[a],f=(this.rowBeats[a]+d)%e.length,g=0;for(void 0===c&&(g=1,c=e[f]);999>g;){if(c===e[(f+e.length-g)%e.length])return g;g++}return 0};